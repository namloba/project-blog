{% extends "base.html" %}
{% block content %}
<div class="post-detail-container">
    <div class="post-card">
        <div class="post-header">
            <h2>{{ post.title }}</h2>
            <div class="post-author">
                <span class="author-name">ğŸ‘¤ {{ post.username }}</span>
                {% if post.role == 'admin' %}
                <span class="admin-badge">â­ Admin</span>
                {% endif %}
            </div>
        </div>
        
        {% if post.image_path %}
        <div class="post-image-detail">
            <img src="/static/{{ post.image_path }}" alt="{{ post.title }}">
        </div>
        {% endif %}
        
        <div class="post-content-detail">
            {{ post.content }}
        </div>
        
        <div class="post-meta">
            <span>ğŸ“… {{ post.created_at }}</span>
        </div>
        
        {% if session.get("user_id") %}
            {% if session.get("user_id") == post.author_id or session.get("role") == "admin" %}
            <div class="post-actions">
                <a href="/edit/{{ post.id }}">âœï¸ Chá»‰nh sá»­a</a>
                <a href="/delete/{{ post.id }}" onclick="return confirm('Báº¡n cÃ³ cháº¯c muá»‘n xÃ³a bÃ i viáº¿t nÃ y?')">ğŸ—‘ï¸ XÃ³a</a>
            </div>
            {% endif %}
        {% endif %}
    </div>
    
    <!-- Comments Section -->
    <div class="comments-section">
        <h3>ğŸ’¬ BÃ¬nh luáº­n ({{ comments|length }})</h3>
        
        {% if session.get("user_id") %}
        <div class="comment-form">
            <form method="POST" action="/post/{{ post.id }}/comment">
                <textarea name="content" placeholder="âœï¸ Viáº¿t bÃ¬nh luáº­n cá»§a báº¡n..." required></textarea>
                <button type="submit">Gá»­i bÃ¬nh luáº­n</button>
            </form>
        </div>
        {% else %}
        <p class="login-prompt">
            <a href="/login">ÄÄƒng nháº­p</a> Ä‘á»ƒ bÃ¬nh luáº­n
        </p>
        {% endif %}
        
        <div class="comments-list">
            {% if comments %}
                {% for comment in comments %}
                <div class="comment-card">
                    <div class="comment-header">
                        <span class="comment-author">
                            ğŸ‘¤ {{ comment.username }}
                            {% if comment.role == 'admin' %}
                            <span class="admin-badge-small">â­</span>
                            {% endif %}
                        </span>
                        <span class="comment-time">{{ comment.created_at }}</span>
                    </div>
                    <div class="comment-content">
                        {{ comment.content }}
                    </div>
                    {% if session.get("user_id") %}
                        {% if session.get("user_id") == comment.user_id or session.get("role") == "admin" %}
                        <div class="comment-actions">
                            <a href="/comment/{{ comment.id }}/delete" onclick="return confirm('XÃ³a bÃ¬nh luáº­n nÃ y?')">ğŸ—‘ï¸ XÃ³a</a>
                        </div>
                        {% endif %}
                    {% endif %}
                </div>
                {% endfor %}
            {% else %}
                <p class="no-comments">ChÆ°a cÃ³ bÃ¬nh luáº­n nÃ o. HÃ£y lÃ  ngÆ°á»i Ä‘áº§u tiÃªn bÃ¬nh luáº­n!</p>
            {% endif %}
        </div>
    </div>
    
    <div class="back-link">
        <a href="/">â† Quay láº¡i trang chá»§</a>
    </div>
</div>
{% endblock %}
